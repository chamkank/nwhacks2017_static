"use strict";const categories=["applied","accepted","waitlisted","rejected"];Object.freeze(categories);const responseCategories=["no response","going","not going","need reimbursement"];Object.freeze(responseCategories),Polymer({is:"select-hackers",properties:{hackers:{type:Array,value:[]},incr:{type:Number,value:0},categories:{type:Array,value:categories},filters:{type:Object,value:function(){return{search:"",status:"",response:""}}},responseCategories:{type:Array,value:responseCategories}},refresh:function(){this.incr++},attached:function(){var e=this;setTimeout(function(){e.resize()},100),window.addEventListener("resize",function(){e.resize()})},resize:function(){var e=this.$.list.getBoundingClientRect().top;this.$.list.style.height=window.innerHeight-e+"px"},observers:["refresh(filters.status)","refresh(filters.checked_in)","refresh(filters.response)","refresh(filters.search)","refresh(filters.mentor)","refresh(filters.first)","refresh(filters.reimbursement)","warnNotAdmin(signedIn, isAdmin, statusKnown)","handleRegistrations(registrations)","signIn(signedIn, statusKnown)"],signIn:function(e,t){t&&!e&&this.$.auth.signInWithPopup()},warnNotAdmin:function(e,t,n){n&&(e&&t===!0?this.$.error.close():e&&(this.error="You are not an admin.",this.$.error.open()))},handleRegistrations:function(e){var t=[];for(var n in e){var r=e[n];r.id=n,t.push(r)}t.sort(function(e,t){return e.id<t.id});var i={};t.forEach(function(e,t){e.index=t;var n=e.email.toLowerCase().trim();i[n]=(i[n]||0)+1}),t.forEach(function(e){var t=e.email.toLowerCase().trim();i[t]>1&&(e.duplicate=!0)});const s=lunr(function(){this.ref("index"),this.field("city"),this.field("email"),this.field("emailSplit"),this.field("github"),this.field("personalsite"),this.field("linkedin"),this.field("name"),this.field("reason"),this.field("school")});t.forEach(function(e,t){var n=e.school.toLowerCase();(n.indexOf("secondary")>=0||n.indexOf("high")>=0)&&(e.hs=!0),e.status?categories.indexOf(e.status)==-1&&(e.status=categories[e.status]):e.status="applied",e.emailSplit=e.email.replace(/@/g," "),s.add(e)}),this.lunr=s,console.log("hackers update");const o=this.$.list.scrollTop;this.hackers=t,this.$.list.scroll(0,o)},cleanEmail:function(e){},responseCat:function(e){return this.responseCategories[e]},eq:function(e,t){return e==t},export:function(){var e=new CSV(this.filtered,{header:!0}).encode();this.downloadFile("applicants_export.csv",e)},downloadFile:function(e,t){var n=new Blob([t]),r=document.createEvent("HTMLEvents");r.initEvent("click"),$("<a>",{download:e,href:webkitURL.createObjectURL(n)}).get(0).dispatchEvent(r)},title:function(e){return e.name+" ("+e.email+")"},filter:function(e,t,n){var r=e;if(this.totalCount=e.length,t.search.length>0){var i=this.lunr.search(t.search);r=i.map(function(t){return e[t.ref]})}var s=t.status,o=t.response,a=this.responded(o),c=r.filter(function(e,n,r){var i=(""===s||"null"===s||"All"===s||s===e.status)&&(""===o||"null"===o||"All"===o||e.acceptance_sent&&a===e.response);return t.mentor&&(i=i&&e.mentor),t.checked_in&&(i=i&&e.checked_in),t.reimbursement&&(i=i&&e.travel_reimbursement),t.first&&(i=i&&e.first_hackathon),i});return this.filtered=c,this.filteredCount=c.length,c},resumeLink:function(e){return"https://firebasestorage.googleapis.com/v0/b/nwhacks-96701.appspot.com/o/"+encodeURIComponent(e)+"?alt=media"},githubLink:function(e){if(e)return e.indexOf("github.com")>0?e:"https://github.com/"+e},linkedinLink:function(e){if(e)return e.indexOf("linkedin.com")>0?e:"https://linkedin.com/in/"+e},selected:function(e){var t=categories.indexOf(e);return t>=0?t:0},responded:function(e){var t=responseCategories.indexOf(e);return t>=0?t:0},eq:function(e,t){return e===t},respondedWith:function(e,t){return e.acceptance_sent&&e.response===t},onSelect:function(e){var t=e.target.selectedIndex,n=categories[t],r=e.model.hacker;r.status!==n&&(this.set("hackers."+r.index+".status",n),this.patchHacker(r))},phoneChange:function(e){var t=e.model.hacker;this.patchHacker(t)},checkIn:function(e){var t=e.model.hacker;this.patchHacker(t)},patchHacker:function(e){this.$.regs.setStoredValue("/registrations/"+e.id,e)},refreshList:function(){this.incr++},handleErr:function(e,t,n){this.handleError(e,t.error)},hackerAdminURL:function(e){return"/api/admin/nwhacks/registration/"+e.id+"/change/"},handleError:function(e,t){console.log("Error",t),this.error=t,this.$.error.open()}});